(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{4556:function(e,t,s){Promise.resolve().then(s.bind(s,2795)),Promise.resolve().then(s.t.bind(s,3624,23)),Promise.resolve().then(s.t.bind(s,8079,23))},2795:function(e,t,s){"use strict";s.r(t),s.d(t,{Providers:function(){return Providers}});var n=s(7573),a=s(8386),o=s(7653);let r=(0,o.createContext)(void 0);function ChatProvider(e){let{children:t}=e,{data:s}=(0,a.useSession)(),[i,c]=(0,o.useState)(null),[l,u]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(null==s?void 0:s.user)&&c({id:"chat-".concat(Date.now()),messages:[],context:{conversationId:"chat-".concat(Date.now()),messages:[],userProfile:{id:s.user.id,name:s.user.name||"Guest",preferences:{savedLocations:{},communicationPreferences:{language:"en",notifications:!0,contactMethod:"chat"}},bookingHistory:[]},systemState:{availableDrivers:[],currentDemand:"low",pricing:{baseRates:{},securityPremium:{},demandMultiplier:1}}}})},[s]);let sendMessage=async e=>{if(i){u(!0);try{var t;let s={id:Date.now().toString(),role:"user",content:e,timestamp:new Date};c(e=>({...e,messages:[...e.messages,s]}));let n=await fetch("/api/ai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,conversationId:i.id})});if(!n.ok)throw Error("Failed to get AI response");let a=await n.json();if(c(e=>({...e,messages:[...e.messages,a.message],context:{...e.context,...a.context}})),(null===(t=a.actions)||void 0===t?void 0:t.length)>0){for(let e of a.actions)if("quote"===e.type&&e.payload.locations){let t=await getSecurityAssessment(e.payload.locations.pickup,e.payload.locations.dropoff);t&&c(e=>({...e,securityAssessment:t}))}}}catch(t){console.error("Error sending message:",t);let e={id:Date.now().toString(),role:"assistant",content:"Sorry, I encountered an error. Please try again later.",timestamp:new Date};c(t=>({...t,messages:[...t.messages,e]}))}finally{u(!1)}}},getSecurityAssessment=async(e,t)=>{try{let s=await fetch("/api/ai/security",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pickup:e,dropoff:t,datetime:new Date().toISOString()})});if(!s.ok)throw Error("Failed to get security assessment");let{assessment:n}=await s.json();return n}catch(e){return console.error("Error getting security assessment:",e),null}};return(0,n.jsx)(r.Provider,{value:{conversation:i,isLoading:l,sendMessage,getSecurityAssessment,clearConversation:()=>{(null==s?void 0:s.user)&&c({id:"chat-".concat(Date.now()),messages:[],context:{conversationId:"chat-".concat(Date.now()),messages:[],userProfile:{id:s.user.id,name:s.user.name||"Guest",preferences:{savedLocations:{},communicationPreferences:{language:"en",notifications:!0,contactMethod:"chat"}},bookingHistory:[]},systemState:{availableDrivers:[],currentDemand:"low",pricing:{baseRates:{},securityPremium:{},demandMultiplier:1}}}})}},children:t})}function Providers(e){let{children:t}=e;return(0,n.jsx)(a.SessionProvider,{children:(0,n.jsx)(ChatProvider,{children:t})})}},3624:function(){}},function(e){e.O(0,[902,293,53,744],function(){return e(e.s=4556)}),_N_E=e.O()}]);