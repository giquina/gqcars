"use strict";(()=>{var e={};e.id=884,e.ids=[884],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},3477:e=>{e.exports=require("querystring")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},8906:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>p,originalPathname:()=>v,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>m});var i={};t.r(i),t.d(i,{POST:()=>POST});var a=t(5789),o=t(4902),n=t(914),s=t(5231);async function POST(e){try{let r=await (0,s.Z1)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!r)return n.Z.json({error:"Unauthorized"},{status:401});let t=await e.json(),{pickup:i,dropoff:a,datetime:o,eventType:u}=t,c=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).findMany({where:{status:"AVAILABLE",siaLicense:{not:null}}}),l={conversationId:Date.now().toString(),messages:[],systemState:{availableDrivers:c.map(e=>({id:e.id,securityLevel:e.siaLicense?["ENHANCED","EXECUTIVE"]:["STANDARD"],status:"available"})),currentDemand:"medium",pricing:{securityPremium:{STANDARD:1,ENHANCED:1.5,EXECUTIVE:2,VIP:3}}}},d=await Object(function(){var e=Error("Cannot find module '@/lib/claude'");throw e.code="MODULE_NOT_FOUND",e}()).getSecurityAssessment(i,a,new Date(o),l);await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).create({data:{pickupLocation:i,dropoffLocation:a,dateTime:new Date(o),riskLevel:d.overallRisk,recommendedSecurityLevel:d.recommendations.securityLevel,additionalMeasures:d.recommendations.additionalMeasures,factors:{time:d.factors.time,location:d.factors.location,route:d.factors.route,eventType:d.factors.eventType}}});let p=c.filter(e=>e.siaLicense&&new Date(e.expiryDate)>new Date);return n.Z.json({assessment:d,availability:{securityDrivers:p.length,estimatedResponse:calculateResponseTime(p,i),nearestDriver:findNearestDriver(p,i)}})}catch(e){return console.error("Security Assessment Error:",e),n.Z.json({error:"Internal Server Error"},{status:500})}}function calculateResponseTime(e,r){return Math.max(5,Math.ceil(15/e.length))}function findNearestDriver(e,r){return e[0]?{id:e[0].id,estimatedArrival:calculateResponseTime([e[0]],r),securityLevel:e[0].siaLicense?"ENHANCED":"STANDARD"}:null}(function(){var e=Error("Cannot find module '@/lib/claude'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}();let u=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/ai/security/route",pathname:"/api/ai/security",filename:"route",bundlePath:"app/api/ai/security/route"},resolvedPagePath:"/workspace/apps/web/src/app/api/ai/security/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:d,headerHooks:p,staticGenerationBailout:m}=u,v="/api/ai/security/route"}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[811,17],()=>__webpack_exec__(8906));module.exports=t})();