"use strict";exports.id=556,exports.ids=[556],exports.modules={17509:(e,t,s)=>{s.d(t,{L:()=>a});var i=s(50147),r=s(92510),o=s(19873);let a={session:{strategy:"jwt"},providers:[(0,i.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await r.Z.user.findUnique({where:{email:e.email}});if(!t)return null;let s=await (0,o.compare)(e.password,t.password);return s?{id:t.id,email:t.email,name:t.name,role:t.role}:null}})],callbacks:{session:({session:e,token:t})=>({...e,user:{...e.user,id:t.id,role:t.role}}),jwt:({token:e,user:t})=>t?{...e,id:t.id,role:t.role}:e},pages:{signIn:"/auth/login"}}},15275:(e,t,s)=>{s.d(t,{w:()=>i});let ClaudeAI=class ClaudeAI{constructor(){this.apiKey=process.env.CLAUDE_API_KEY||"",this.baseUrl=process.env.CLAUDE_API_URL||"https://api.anthropic.com/v1",this.model="claude-3-opus-20240229"}async callClaude(e,t,s){try{let i=await fetch(`${this.baseUrl}/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:this.model,messages:[s?{role:"system",content:s}:null,...e.map(e=>({role:e.role,content:e.content}))].filter(Boolean),context:{conversation_id:t.conversationId,user_profile:t.userProfile,system_state:t.systemState},max_tokens:1e3})});if(!i.ok)throw Error(`Claude API error: ${i.statusText}`);let r=await i.json();return this.processClaudeResponse(r,t)}catch(e){throw console.error("Claude API error:",e),e}}processClaudeResponse(e,t){let s={message:{id:e.id,role:"assistant",content:e.content,timestamp:new Date,metadata:{context:e.context,intent:e.intent,confidence:e.confidence,entities:e.entities}},actions:this.extractActions(e.content,t),context:{intent:e.intent,entities:e.entities,nextSteps:e.next_steps}};return s}extractActions(e,t){let s=[];return(e.toLowerCase().includes("quote")||e.toLowerCase().includes("price"))&&s.push({type:"quote",payload:{service:this.detectServiceType(e),security:this.detectSecurityLevel(e),locations:this.extractLocations(e)}}),(e.toLowerCase().includes("book")||e.toLowerCase().includes("schedule"))&&s.push({type:"book",payload:{service:this.detectServiceType(e),security:this.detectSecurityLevel(e),datetime:this.extractDateTime(e)}}),(e.toLowerCase().includes("security")||e.toLowerCase().includes("protection"))&&s.push({type:"security",payload:{level:this.detectSecurityLevel(e),concerns:this.extractSecurityConcerns(e)}}),s}detectServiceType(e){let t=e.toLowerCase();return t.includes("executive")||t.includes("luxury")?"EXECUTIVE":t.includes("airport")?"AIRPORT_TRANSFER":t.includes("corporate")?"CORPORATE":t.includes("wedding")?"WEDDING":t.includes("security")||t.includes("protection")?"SECURITY":t.includes("private")?"PRIVATE_HIRE":"TAXI"}detectSecurityLevel(e){let t=e.toLowerCase();return t.includes("vip")||t.includes("executive protection")?"VIP":t.includes("enhanced")||t.includes("close protection")?"ENHANCED":t.includes("executive")?"EXECUTIVE":"STANDARD"}extractLocations(e){let t={pickup:void 0,dropoff:void 0},s=e.match(/from\s+([^,]+?)(?=\s+to|$)/i),i=e.match(/to\s+([^,.]+)/i);return s&&(t.pickup=s[1].trim()),i&&(t.dropoff=i[1].trim()),t}extractDateTime(e){let t=new Date;if(e.toLowerCase().includes("now")||e.toLowerCase().includes("asap"))return t;if(e.toLowerCase().includes("tomorrow")){let e=new Date(t);return e.setDate(e.getDate()+1),e}}extractSecurityConcerns(e){let t=[];return e.toLowerCase().includes("night")&&t.push("Night-time travel"),(e.toLowerCase().includes("valuable")||e.toLowerCase().includes("jewelry"))&&t.push("Valuable items transport"),(e.toLowerCase().includes("profile")||e.toLowerCase().includes("celebrity"))&&t.push("High-profile client"),t}async chat(e,t){let s=[{id:Date.now().toString(),role:"user",content:e,timestamp:new Date}];return this.callClaude(s,t)}async getSecurityAssessment(e,t,s,i){let r=`Please assess the security requirements for a journey from ${e} to ${t} at ${s.toISOString()}.`,o=await this.chat(r,{...i,systemState:{...i.systemState,currentDemand:this.calculateDemand(s)}}),a={overallRisk:"low",factors:{time:0,location:0,route:0},recommendations:{securityLevel:"STANDARD",additionalMeasures:[]}};if(o.actions?.find(e=>"security"===e.type)){let e=o.actions.find(e=>"security"===e.type);a.overallRisk=this.calculateRiskLevel(e.payload),a.recommendations.securityLevel=e.payload.level,a.recommendations.additionalMeasures=e.payload.concerns}return a}calculateDemand(e){let t=e.getHours(),s=e.getDay();return t>=7&&t<=9||t>=16&&t<=18?"high":(5===s||6===s)&&t>=20?"surge":t>=9&&t<=17?"medium":"low"}calculateRiskLevel(e){let t=e.concerns?.length||0,s=e.level;return t>=3||"VIP"===s?"high":t>=1||"ENHANCED"===s?"medium":"low"}};let i=new ClaudeAI},92510:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(53524);let r=globalThis.prisma??new i.PrismaClient,o=r}};